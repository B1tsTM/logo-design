<section class="app-headline">
		<div class="row">
			<div class="column small-12">
				<div class="app-breadcrumbs">
					<a routerLink="/">Pagrindinis puslapis</a>
					<a routerLink="/konkursai">Konkursai</a>
					<a>Konk1</a>
				</div>
			</div>
		</div>
	</section>


<div *ngIf="!contest">Kraunama...</div>
<div *ngIf="contest">  

  <div class="section-name">
  <h1 class="text-center">Konkurso detalės</h1>
</div>

<div class="section-status">
  <h2 class="text-center">Statusas: <span class="section-status-span" [ngClass]="{'active': contest.status == 'Aktyvus', 'finished': contest.status == 'Užbaigtas', 'timed-out': contest.status == 'Laikas baigėsi', 'resumed': contest.status == 'Pratęstas', 'cancelled': contest.status == 'Atšauktas', 'unconfirmed': contest.status == 'Nepatvirtintas'}">{{contest.status}}</span></h2>
</div>

  <h3>Extra files:</h3>
  <div class="inline-block thumbnail-container" *ngFor="let file of additionalFiles | paginate: {id: 'three', itemsPerPage: 5, currentPage: p3}" >
    <img class="mini-image" src="http://localhost:3000/uploads/contests/{{contestId}}/{{file.fileUrl}}" alt="Failas">
  </div>
  <pagination-controls *ngIf="additionalFiles.length > 5" id="three" (pageChange)="p3 = $event" directionLinks="false" #api3></pagination-controls>
    <div *ngIf="isContestPublisher(contest.publisher._id) && isEmailConfirmed()">
    <input type="file" name="additionalFiles" (change)="fileChangeEvent($event)" placeholder="Pasirinkite..." multiple />
    <button type="button" [disabled]="filesToUpload.length == 0" (click)="uploadAdditionalFiles()">Upload</button>
    {{percent}} %
  </div>
  <br>
  <div *ngIf="contest.status == 'Užbaigtas'">Konkursas užbaigtas !</div>
  <div *ngIf="contest.status == 'Laikas baigėsi'">Konkurso laikas baigėsi</div>
  <br>
  <div *ngIf="winnerSubmition">
    <div class="winner-submition-label">
      <h2 class="text-center">Nugalėtojas</h2>
    </div>
    <div class="winner-container">
      <div class="winner-container-image">
      <div class="winner-submition-sub-label">Dizainas: #{{winnerSubmition?.submitionId}} </div>
      <img class="mini-image" (click)="viewSubmitionDetails(contestId, contest, winnerSubmition)" src="http://localhost:3000/uploads/contests/{{contestId}}/{{winnerSubmition.submitionUrl}}" alt="Submition">
        <br>
        <span class="italic">Autorius: {{winnerSubmition?.submitionAuthor?.nickName}}</span>
      </div>
    </div>
    <div class="winner-extra-info">
      <div class="extra-info-col-one">
        <h2 class="extra-info-text">Nugalėtojas buvo išrinktas iš {{contest.submitions.length}} dizainų.</h2>
      </div>
      <div class="extra-info-col-two">
        <h2 class="extra-info-text">Konkurse dalyvavo {{contest.participants.length}} {{contest.participants.length < 10 ? 'dizaineriai' : 'dizainerių'}}</h2>
      </div>
    </div>
  </div>
  <h2 class="text-center">Submitions ({{submitions.length}})</h2>
  <div *ngIf="submitions.length == 0"><h4>No submitions uploaded</h4></div>
  <div class="thumbnail-row" *ngIf="contestId">
    <div class="inline-block thumbnail-container" *ngFor="let submition of submitions | paginate: {id: 'one', itemsPerPage: 10, currentPage: p1}">
      <div class="mini-image-container">
      <div class="pad-left-60">SubmitionID: {{submition.submitionId}}</div>
      <img class="mini-image" (click)="viewSubmitionDetails(contestId, contest, submition)" src="http://localhost:3000/uploads/contests/{{contestId}}/{{submition.submitionUrl}}" alt="Submition">
      <br>
      <span class="pad-left-60">Author: {{submition.submitionAuthor.nickName}}</span>
      <div>
        <star-rating class="star-rating" *ngIf="!isContestPublisher(contest.publisher._id)" [rating]="submition.submitionRating" [readonly]="true" [submitionId]="submition.submitionId" [contestId]="contest.idName" (ratingClicked)="onRating($event)"></star-rating>
        <star-rating class="star-rating" *ngIf="isContestPublisher(contest.publisher._id)" [rating]="submition.submitionRating" [readonly]="false" [submitionId]="submition.submitionId" [contestId]="contest.idName" (ratingClicked)="onRating($event)"></star-rating>
      </div>
      <span class="pad-left-60" *ngIf="submition.comments">{{submition.comments.length}} comments</span>
      <!--<submition-details [contestId]="contestId" [contest]="contest" [submition]="submition"></submition-details>-->
    </div>
  </div>
  </div>
  <pagination-controls *ngIf="submitions.length > 0 && isDesigner()" id="one" (pageChange)="p1 = $event" directionLinks="false" #api1></pagination-controls>
  <br>
  <div *ngIf="mySubmitions.length > 0 && isDesigner()">
    <h2 class="text-center">My submitions ({{mySubmitions.length}})</h2>
    <div class="thumbnail-row">
      <div class="inline-block thumbnail-container" *ngFor="let mySubmition of mySubmitions | paginate: {id: 'two', itemsPerPage: 10, currentPage: p2}">
        <div class="mini-image-container">
        <div class="pad-left-60">SubmitionID: {{mySubmition.submitionId}}</div>
        <img class="mini-image" src="http://localhost:3000/uploads/contests/{{contestId}}/{{mySubmition.submitionUrl}}" alt="Submition">
          <br>
          <span class="pad-left-60">Author: {{mySubmition.submitionAuthor.nickName}} (debug) </span>
            <div>
              <star-rating class="star-rating" [rating]="mySubmition.submitionRating" [readonly]="true" [submitionId]="mySubmition.submitionId" [contestId]="contest.idName" (ratingClicked)="onRating($event)"></star-rating>
            </div> 
          <span class="pad-left-60" *ngIf="mySubmition.comments">{{mySubmition.comments.length}} comments</span>
        </div>
      </div>
    </div>
    <br>
  </div>  
  <pagination-controls *ngIf="mySubmitions.length > 0 && isDesigner()" id="two" (pageChange)="p2 = $event" directionLinks="false" #api2></pagination-controls>
  <div *ngIf="!isLoggedIn() && contest.status != 'Užbaigtas' && contest.status != 'Laikas baigėsi'">Kad galėtumėte dalyvauti konkurse, turite būti prisijungęs kaip registruotas dizaineris</div>
  <div *ngIf="isDesigner() && contest.status != 'Užbaigtas' && contest.status != 'Laikas baigėsi' && !isEmailConfirmed()"><h2 class="text-center">Kad galėtumėte dalyvauti konkurse, patvirtinkite savo el. pašto paskyrą profilio nustatymuose</h2></div>
  <div *ngIf="isDesigner() && contest.status != 'Užbaigtas' && contest.status != 'Laikas baigėsi' && isEmailConfirmed()">
    <h2>Participate:</h2>
  <input type="file" name="submition" (change)="fileChangeEvent($event)" placeholder="Pasirinkite..." multiple />
  <button type="button" [disabled]="filesToUpload.length == 0" (click)="uploadSubmitions()">Upload</button>
  {{percent}} %
  </div>
  <div *ngIf="isClient() && contest.status != 'Užbaigtas' && contest.status != 'Laikas baigėsi'">Kad galėtumėte dalyvauti konkurse, turite būti registruotas dizaineris</div>

  <div class="comments-section">
    <comments-section [contest]="contest"></comments-section>
  </div>
  
</div>

<simple-notifications [options]="options"></simple-notifications>

<test-loader *ngIf="isLoading"></test-loader>
